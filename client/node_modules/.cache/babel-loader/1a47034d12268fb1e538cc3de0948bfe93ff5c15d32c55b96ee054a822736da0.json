{"ast":null,"code":"var _jsxFileName = \"/workspaces/chart-ni225/client/src/Chart/Chart.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useMemo } from \"react\";\nimport { XAxis, YAxis, Tooltip, CartesianGrid, ResponsiveContainer, ComposedChart, Bar } from \"recharts\";\nimport PeriodSelector from \"./PeriodSelector\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst getPeriodCount = period => {\n  switch (period) {\n    case \"1y\":\n      return 365;\n    case \"6m\":\n      return 183;\n    case \"3m\":\n      return 92;\n    case \"1m\":\n      return 31;\n    case \"1w\":\n      return 7;\n    default:\n      return 365;\n  }\n};\nconst Candle = props => {\n  const {\n    x,\n    y,\n    width,\n    height,\n    fill\n  } = props;\n  return /*#__PURE__*/_jsxDEV(\"rect\", {\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n    fill: fill,\n    stroke: \"#333\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 36,\n    columnNumber: 10\n  }, this);\n};\n_c = Candle;\nconst Chart = ({\n  data\n}) => {\n  _s();\n  const [period, setPeriod] = useState(\"1y\");\n  const filteredData = useMemo(() => {\n    const count = getPeriodCount(period);\n    return data.slice(-count);\n  }, [data, period]);\n\n  // ローソク足用のカスタムBarデータ\n  const renderCandles = props => {\n    const {\n      x,\n      width,\n      payload,\n      y: yValue\n    } = props;\n    // rechartsのBar shapeではyはスケール関数ではなく、バーのy座標値\n    // そのため、Y軸のスケールを取得するにはComposedChartのchildrenとしてカスタムでYAxisのスケールを渡す必要があるが、\n    // ここではBarのy, height, payloadから計算する\n    // ただし、Barのshapeではopen/close/high/lowのy座標を直接取得できないため、\n    // BarのdataKeyはダミーで、payloadから値を取得して描画する\n    // yValueはcloseのy座標\n    const chartHeight = 400 * 0.85; // ResponsiveContainer height\n    const min = Math.min(payload.open, payload.close, payload.high, payload.low);\n    const max = Math.max(payload.open, payload.close, payload.high, payload.low);\n    // y座標計算（Y軸の値をチャート座標に変換）\n    const yScale = v => {\n      // YAxisのdomainは[\"auto\", \"auto\"]なので、filteredDataからmin/maxを取得\n      const values = [payload.open, payload.close, payload.high, payload.low];\n      const dataMin = Math.min(...values);\n      const dataMax = Math.max(...values);\n      // 上下反転\n      return (dataMax - v) / (dataMax - dataMin) * chartHeight;\n    };\n    const color = payload.close > payload.open ? \"#e74c3c\" : \"#2ecc71\";\n    const openY = yScale(payload.open);\n    const closeY = yScale(payload.close);\n    const highY = yScale(payload.high);\n    const lowY = yScale(payload.low);\n    const candleY = Math.min(openY, closeY);\n    const candleHeight = Math.abs(openY - closeY);\n    return /*#__PURE__*/_jsxDEV(\"g\", {\n      children: [/*#__PURE__*/_jsxDEV(\"line\", {\n        x1: x + width / 2,\n        x2: x + width / 2,\n        y1: highY,\n        y2: lowY,\n        stroke: color,\n        strokeWidth: 2\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"rect\", {\n        x: x,\n        y: candleY,\n        width: width,\n        height: candleHeight === 0 ? 1 : candleHeight,\n        fill: color,\n        stroke: \"#333\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      width: \"100%\",\n      height: 400\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\u65E5\\u7D4C\\u5E73\\u5747\\u682A\\u4FA1\\uFF08\\u30ED\\u30FC\\u30BD\\u30AF\\u8DB3\\u30FB\\u671F\\u9593\\u9078\\u629E\\u53EF\\uFF09\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PeriodSelector, {\n      period: period,\n      onChange: setPeriod\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ResponsiveContainer, {\n      width: \"100%\",\n      height: \"85%\",\n      children: /*#__PURE__*/_jsxDEV(ComposedChart, {\n        data: filteredData,\n        margin: {\n          top: 20,\n          right: 30,\n          left: 0,\n          bottom: 0\n        },\n        barCategoryGap: 2,\n        children: [/*#__PURE__*/_jsxDEV(CartesianGrid, {\n          strokeDasharray: \"3 3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(XAxis, {\n          dataKey: \"date\",\n          minTickGap: 40\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(YAxis, {\n          domain: [\"auto\", \"auto\"]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Tooltip, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Bar, {\n          dataKey: \"close\",\n          shape: renderCandles,\n          minPointSize: 1,\n          maxBarSize: 10,\n          isAnimationActive: false\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 5\n  }, this);\n};\n_s(Chart, \"1IwMxhIkj+hXn6vksZLa7IVE440=\");\n_c2 = Chart;\nexport default Chart;\nvar _c, _c2;\n$RefreshReg$(_c, \"Candle\");\n$RefreshReg$(_c2, \"Chart\");","map":{"version":3,"names":["React","useState","useMemo","XAxis","YAxis","Tooltip","CartesianGrid","ResponsiveContainer","ComposedChart","Bar","PeriodSelector","jsxDEV","_jsxDEV","getPeriodCount","period","Candle","props","x","y","width","height","fill","stroke","fileName","_jsxFileName","lineNumber","columnNumber","_c","Chart","data","_s","setPeriod","filteredData","count","slice","renderCandles","payload","yValue","chartHeight","min","Math","open","close","high","low","max","yScale","v","values","dataMin","dataMax","color","openY","closeY","highY","lowY","candleY","candleHeight","abs","children","x1","x2","y1","y2","strokeWidth","style","onChange","margin","top","right","left","bottom","barCategoryGap","strokeDasharray","dataKey","minTickGap","domain","shape","minPointSize","maxBarSize","isAnimationActive","_c2","$RefreshReg$"],"sources":["/workspaces/chart-ni225/client/src/Chart/Chart.tsx"],"sourcesContent":["import React, { useState, useMemo } from \"react\";\nimport { XAxis, YAxis, Tooltip, CartesianGrid, ResponsiveContainer, ComposedChart, Bar } from \"recharts\";\nimport PeriodSelector from \"./PeriodSelector\";\n\ninterface DataPoint {\n  date: string;\n  open: number;\n  high: number;\n  low: number;\n  close: number;\n}\n\ninterface ChartProps {\n  data: DataPoint[];\n}\n\nconst getPeriodCount = (period: string) => {\n  switch (period) {\n    case \"1y\":\n      return 365;\n    case \"6m\":\n      return 183;\n    case \"3m\":\n      return 92;\n    case \"1m\":\n      return 31;\n    case \"1w\":\n      return 7;\n    default:\n      return 365;\n  }\n};\n\nconst Candle = (props: any) => {\n  const { x, y, width, height, fill } = props;\n  return <rect x={x} y={y} width={width} height={height} fill={fill} stroke=\"#333\" />;\n};\n\nconst Chart: React.FC<ChartProps> = ({ data }) => {\n  const [period, setPeriod] = useState<string>(\"1y\");\n\n  const filteredData = useMemo(() => {\n    const count = getPeriodCount(period);\n    return data.slice(-count);\n  }, [data, period]);\n\n  // ローソク足用のカスタムBarデータ\n  const renderCandles = (props: any) => {\n    const { x, width, payload, y: yValue } = props;\n    // rechartsのBar shapeではyはスケール関数ではなく、バーのy座標値\n    // そのため、Y軸のスケールを取得するにはComposedChartのchildrenとしてカスタムでYAxisのスケールを渡す必要があるが、\n    // ここではBarのy, height, payloadから計算する\n    // ただし、Barのshapeではopen/close/high/lowのy座標を直接取得できないため、\n    // BarのdataKeyはダミーで、payloadから値を取得して描画する\n    // yValueはcloseのy座標\n    const chartHeight = 400 * 0.85; // ResponsiveContainer height\n    const min = Math.min(payload.open, payload.close, payload.high, payload.low);\n    const max = Math.max(payload.open, payload.close, payload.high, payload.low);\n    // y座標計算（Y軸の値をチャート座標に変換）\n    const yScale = (v: number) => {\n      // YAxisのdomainは[\"auto\", \"auto\"]なので、filteredDataからmin/maxを取得\n      const values = [payload.open, payload.close, payload.high, payload.low];\n      const dataMin = Math.min(...values);\n      const dataMax = Math.max(...values);\n      // 上下反転\n      return ((dataMax - v) / (dataMax - dataMin)) * chartHeight;\n    };\n    const color = payload.close > payload.open ? \"#e74c3c\" : \"#2ecc71\";\n    const openY = yScale(payload.open);\n    const closeY = yScale(payload.close);\n    const highY = yScale(payload.high);\n    const lowY = yScale(payload.low);\n    const candleY = Math.min(openY, closeY);\n    const candleHeight = Math.abs(openY - closeY);\n    return (\n      <g>\n        {/* ヒゲ */}\n        <line x1={x + width / 2} x2={x + width / 2} y1={highY} y2={lowY} stroke={color} strokeWidth={2} />\n        {/* 実体 */}\n        <rect\n          x={x}\n          y={candleY}\n          width={width}\n          height={candleHeight === 0 ? 1 : candleHeight}\n          fill={color}\n          stroke=\"#333\"\n        />\n      </g>\n    );\n  };\n\n  return (\n    <div style={{ width: \"100%\", height: 400 }}>\n      <h2>日経平均株価（ローソク足・期間選択可）</h2>\n      <PeriodSelector period={period} onChange={setPeriod} />\n      <ResponsiveContainer width=\"100%\" height=\"85%\">\n        <ComposedChart data={filteredData} margin={{ top: 20, right: 30, left: 0, bottom: 0 }} barCategoryGap={2}>\n          <CartesianGrid strokeDasharray=\"3 3\" />\n          <XAxis dataKey=\"date\" minTickGap={40} />\n          <YAxis domain={[\"auto\", \"auto\"]} />\n          <Tooltip />\n          <Bar\n            dataKey=\"close\"\n            shape={renderCandles}\n            minPointSize={1}\n            maxBarSize={10}\n            isAnimationActive={false}\n          />\n        </ComposedChart>\n      </ResponsiveContainer>\n    </div>\n  );\n};\n\nexport default Chart;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}